% calculate_variable_delays.m
function [n_DD2A, n_UG2D] = calculate_variable_delays(j, N_TBPHC, ...
                                                      n_rep_PDSCH, ...
                                                      n_rep_PUSCH, ...
                                                      n_rep_PUCCH, ...
                                                      n_rep_PDCCH, ...
                                                      N_switch, ...
                                                      use_bundling, ...
                                                      n_bundle)
    % Downlink DD2A delay (Eq. 12 or 14)
    if ~use_bundling
        n_DD2A = (N_TBPHC - j) * n_rep_PDSCH + ...
                 (j - 1) * n_rep_PUCCH + N_switch;
    else
        n_DD2A = (N_TBPHC - j) * n_rep_PDSCH + ...
                 floor((j - 1) / n_bundle) * n_rep_PUCCH + N_switch;
    end
    
    % Uplink UG2D delay (Eq. 13)
    n_UG2D = (N_TBPHC - j) * n_rep_PDCCH + ...
             (j - 1) * n_rep_PUSCH + N_switch;
end